<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialScanAI - Akƒ±llƒ± √úr√ºn Arama</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    
    body { 
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; 
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); 
      min-height:100vh; 
      color:#333;
      overflow-x:hidden;
    }
    
    .container { 
      max-width:1400px; 
      margin:0 auto; 
      padding:20px;
      position:relative;
    }
    
    /* Animated background particles */
    .bg-particle {
      position:absolute;
      width:4px;
      height:4px;
      background:rgba(255,255,255,0.3);
      border-radius:50%;
      animation:float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform:translateY(0px) rotate(0deg); }
      50% { transform:translateY(-20px) rotate(180deg); }
    }
    
    .header { 
      text-align:center; 
      margin-bottom:50px; 
      color:#fff;
      position:relative;
      z-index:10;
    }
    
    .header h1{ 
      font-size:4rem; 
      margin-bottom:15px; 
      text-shadow:3px 3px 6px rgba(0,0,0,0.4);
      background:linear-gradient(45deg, #fff, #f0f8ff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    
    .header p{ 
      font-size:1.4rem; 
      opacity:.95;
      text-shadow:1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .search-container{ 
      background:rgba(255,255,255,0.95); 
      backdrop-filter:blur(20px);
      border-radius:25px; 
      padding:50px; 
      box-shadow:0 25px 50px rgba(0,0,0,.15); 
      margin-bottom:40px;
      border:1px solid rgba(255,255,255,0.2);
      position:relative;
      overflow:hidden;
    }
    
    .search-container::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, #667eea, #764ba2, #667eea);
      background-size:200% 100%;
      animation:shimmer 3s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0% { background-position:200% 0; }
      100% { background-position:-200% 0; }
    }
    
    .search-tabs{ 
      display:flex; 
      margin-bottom:40px; 
      border-radius:15px; 
      overflow:hidden;
      background:rgba(248,249,250,0.8);
      backdrop-filter:blur(10px);
      border:1px solid rgba(0,0,0,0.1);
    }
    
    .tab-button{ 
      flex:1; 
      padding:20px 25px; 
      background:transparent; 
      border:none; 
      cursor:pointer; 
      font-size:17px; 
      font-weight:600; 
      transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      gap:12px;
      position:relative;
      color:#666;
    }
    
    .tab-button.active{ 
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); 
      color:#fff;
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(102,126,234,0.4);
    }
    
    .tab-button:hover:not(.active) {
      background:rgba(102,126,234,0.1);
      transform:translateY(-1px);
    }
    
    .search-form{ 
      display:none;
      animation:fadeIn 0.5s ease-in-out;
    }
    
    .search-form.active{ display:block }
    
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px); }
      to { opacity:1; transform:translateY(0); }
    }
    
    .form-group{ 
      margin-bottom:25px;
      position:relative;
    }
    
    .form-group label{ 
      display:block; 
      margin-bottom:10px; 
      font-weight:600; 
      color:#555;
      font-size:16px;
    }
    
    .form-group select,
    .form-group input[type="text"]{ 
      width:100%; 
      padding:18px 20px; 
      border:2px solid #e9ecef; 
      border-radius:12px; 
      font-size:16px;
      transition:all 0.3s ease;
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(10px);
    }
    
    .form-group select:focus,
    .form-group input[type="text"]:focus {
      outline:none;
      border-color:#667eea;
      box-shadow:0 0 0 4px rgba(102,126,234,0.1);
      transform:translateY(-1px);
    }
    
    .file-upload{ 
      border:3px dashed #667eea; 
      border-radius:15px; 
      padding:50px; 
      text-align:center; 
      cursor:pointer; 
      background:linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));
      transition:all 0.3s ease;
      position:relative;
    }
    
    .file-upload:hover {
      border-color:#764ba2;
      background:linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
      transform:translateY(-2px);
    }
    
    .file-upload.dragover {
      border-color:#28a745;
      background:linear-gradient(135deg, rgba(40,167,69,0.1), rgba(40,167,69,0.05));
      transform:scale(1.02);
    }
    
    .search-button{ 
      width:100%; 
      padding:20px; 
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); 
      color:#fff; 
      border:none; 
      border-radius:12px; 
      font-size:18px; 
      font-weight:600; 
      cursor:pointer;
      transition:all 0.3s ease;
      position:relative;
      overflow:hidden;
    }
    
    .search-button:hover {
      transform:translateY(-3px);
      box-shadow:0 15px 35px rgba(102,126,234,0.4);
    }
    
    .search-button:active {
      transform:translateY(-1px);
    }
    
    .loading,.results,.error{ display:none }
    .loading.active,.results.active,.error.active{ display:block }
    
    .spinner{ 
      border:4px solid rgba(255,255,255,0.3); 
      border-top:4px solid #fff; 
      border-radius:50%; 
      width:60px; 
      height:60px; 
      animation:spin 1s linear infinite; 
      margin:0 auto 25px;
    }
    
    @keyframes spin{ 0%{ transform:rotate(0deg) } 100%{ transform:rotate(360deg) } }
    
    .loading {
      text-align:center;
      color:#fff;
      padding:50px;
    }
    
    .loading h3 {
      font-size:1.5rem;
      margin-bottom:10px;
    }
    
    .loading p {
      opacity:0.8;
      font-size:1.1rem;
    }

    .best-offer-card{ 
      background:rgba(255,255,255,0.95); 
      backdrop-filter:blur(20px);
      border-radius:20px; 
      padding:40px; 
      box-shadow:0 20px 40px rgba(0,0,0,.1); 
      display:flex; 
      gap:40px; 
      margin-bottom:40px; 
      border:2px solid #28a745;
      position:relative;
      overflow:hidden;
      transition:transform 0.3s ease;
    }
    
    .best-offer-card:hover {
      transform:translateY(-5px);
    }
    
    .best-offer-card::before {
      content:'üèÜ EN ƒ∞Yƒ∞ SE√áENEK';
      position:absolute;
      top:15px;
      right:15px;
      background:linear-gradient(135deg, #28a745, #20c997);
      color:#fff;
      padding:8px 15px;
      border-radius:20px;
      font-size:12px;
      font-weight:bold;
      letter-spacing:0.5px;
    }
    
    .best-offer-image{ 
      width:280px; 
      height:280px; 
      object-fit:cover; 
      border-radius:15px; 
      flex-shrink:0;
      transition:transform 0.3s ease;
      box-shadow:0 10px 25px rgba(0,0,0,0.1);
    }
    
    .best-offer-image:hover {
      transform:scale(1.05);
    }
    
    .best-offer-details{ flex-grow:1 }
    
    .best-offer-title{ 
      font-size:2rem; 
      font-weight:bold; 
      margin-bottom:15px;
      color:#333;
      margin-top:20px;
    }
    
    .best-offer-meta{ 
      display:flex; 
      gap:25px; 
      font-size:1.2rem; 
      margin-bottom:25px;
      flex-wrap:wrap;
    }
    
    .meta-item {
      background:rgba(102,126,234,0.1);
      padding:8px 15px;
      border-radius:20px;
      font-weight:600;
    }
    
    .stock-list{ 
      list-style:none; 
      margin:25px 0;
      background:rgba(248,249,250,0.8);
      border-radius:12px;
      padding:20px;
    }
    
    .stock-item{ 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      padding:12px 0; 
      border-bottom:1px solid rgba(0,0,0,0.1);
    }
    
    .stock-item:last-child {
      border-bottom:none;
    }
    
    .stock-size{ 
      font-weight:bold;
      font-size:1.1rem;
    }
    
    .stock-status.available{ 
      color:#28a745; 
      font-weight:600;
      background:rgba(40,167,69,0.1);
      padding:6px 12px;
      border-radius:15px;
    }
    
    .stock-status.unavailable{ 
      color:#dc3545; 
      font-weight:600;
      display:flex;
      align-items:center;
      gap:10px;
    }
    
    .track-size-button{ 
      background:linear-gradient(135deg, #007bff, #0056b3); 
      color:#fff; 
      border:none; 
      padding:8px 15px; 
      border-radius:20px; 
      cursor:pointer; 
      font-size:13px;
      font-weight:600;
      transition:all 0.3s ease;
      white-space:nowrap;
    }
    
    .track-size-button:hover {
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,123,255,0.4);
    }
    
    .track-price-button{ 
      background:linear-gradient(135deg, #ffc107, #ff8c00); 
      color:#333; 
      border:none; 
      padding:15px 25px; 
      border-radius:12px; 
      cursor:pointer; 
      font-weight:600; 
      width:100%; 
      margin-top:15px;
      font-size:16px;
      transition:all 0.3s ease;
    }
    
    .track-price-button:hover {
      transform:translateY(-2px);
      box-shadow:0 10px 25px rgba(255,193,7,0.4);
    }
    
    .track-size-button:disabled,
    .track-price-button:disabled{ 
      background:linear-gradient(135deg, #28a745, #20c997); 
      cursor:not-allowed; 
      opacity:.9;
      transform:none;
    }
    
    .other-offers-container h3{ 
      color:#fff; 
      margin-bottom:25px; 
      text-align:center;
      font-size:1.8rem;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .other-offers-grid{ 
      display:grid; 
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); 
      gap:25px;
    }
    
    .other-offer-card{ 
      background:rgba(255,255,255,0.95); 
      backdrop-filter:blur(20px);
      border-radius:15px; 
      padding:25px; 
      box-shadow:0 10px 25px rgba(0,0,0,.1);
      transition:all 0.3s ease;
      border:1px solid rgba(255,255,255,0.2);
    }
    
    .other-offer-card:hover {
      transform:translateY(-5px);
      box-shadow:0 20px 40px rgba(0,0,0,.15);
    }
    
    .other-offer-card h4{ 
      font-size:1.2rem; 
      margin-bottom:12px;
      color:#333;
    }
    
    .other-offer-meta{ 
      display:flex; 
      justify-content:space-between; 
      align-items:center;
      margin-bottom:8px;
    }
    
    .other-price{ 
      font-size:1.3rem; 
      font-weight:bold; 
      color:#28a745;
    }
    
    .error{ 
      background:linear-gradient(135deg, #dc3545, #c82333); 
      color:#fff; 
      padding:25px; 
      border-radius:15px; 
      margin:25px 0;
      box-shadow:0 10px 25px rgba(220,53,69,0.3);
    }

    /* Phone Modal */
    .modal-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.7);
      backdrop-filter:blur(10px);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:1000;
      animation:fadeIn 0.3s ease;
    }
    
    .modal-overlay.active {
      display:flex;
    }
    
    .modal-content {
      background:rgba(255,255,255,0.95);
      backdrop-filter:blur(20px);
      border-radius:20px;
      padding:40px;
      max-width:450px;
      width:90%;
      text-align:center;
      transform:scale(0.9);
      transition:transform 0.3s ease;
      border:1px solid rgba(255,255,255,0.3);
    }
    
    .modal-overlay.active .modal-content {
      transform:scale(1);
    }
    
    .modal-content h3 {
      color:#333;
      margin-bottom:20px;
      font-size:1.5rem;
    }
    
    .phone-input {
      width:100%;
      padding:15px 20px;
      border:2px solid #e9ecef;
      border-radius:12px;
      font-size:16px;
      margin-bottom:25px;
      text-align:center;
      transition:all 0.3s ease;
    }
    
    .phone-input:focus {
      outline:none;
      border-color:#667eea;
      box-shadow:0 0 0 4px rgba(102,126,234,0.1);
    }
    
    .modal-buttons {
      display:flex;
      gap:15px;
    }
    
    .modal-button {
      flex:1;
      padding:12px 25px;
      border:none;
      border-radius:10px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    
    .modal-button.primary {
      background:linear-gradient(135deg,#667eea,#764ba2);
      color:#fff;
    }
    
    .modal-button.primary:hover {
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(102,126,234,0.4);
    }
    
    .modal-button.secondary {
      background:#f8f9fa;
      color:#666;
      border:1px solid #dee2e6;
    }
    
    .modal-button.secondary:hover {
      background:#e9ecef;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header h1 { font-size:2.5rem; }
      .search-container { padding:25px; }
      .best-offer-card { flex-direction:column; gap:20px; }
      .best-offer-image { width:100%; height:250px; }
      .best-offer-meta { flex-direction:column; gap:10px; }
      .other-offers-grid { grid-template-columns:1fr; }
      .modal-content { padding:25px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Animated background particles -->
    <div class="bg-particle" style="top:10%; left:10%; animation-delay:0s;"></div>
    <div class="bg-particle" style="top:20%; right:15%; animation-delay:1s;"></div>
    <div class="bg-particle" style="bottom:30%; left:20%; animation-delay:2s;"></div>
    <div class="bg-particle" style="bottom:10%; right:10%; animation-delay:3s;"></div>
    
    <div class="header">
      <h1>üîç SocialScanAI</h1>
      <p>Hibrit AI ile Akƒ±llƒ± √úr√ºn Arama ve Ger√ßek Zamanlƒ± Takip Sistemi</p>
    </div>

    <div class="search-container">
      <div class="search-tabs">
        <button class="tab-button active" onclick="switchTab('text', this)">
          üí¨ Metin Arama
        </button>
        <button class="tab-button" onclick="switchTab('image', this)">
          üñºÔ∏è G√∂rsel Arama
        </button>
      </div>

      <form class="search-form active" id="text-form">
        <div class="form-group">
          <label for="text-category">üè∑Ô∏è Kategori Se√ßin</label>
          <select id="text-category" required>
            <option value="">Kategori se√ßiniz...</option>
            <option value="ayakkabi">üëü Ayakkabƒ±</option>
            <option value="sapka">üß¢ ≈ûapka</option>
            <option value="sweat">üëï Sweatshirt</option>
            <option value="tshirt">üëî T-Shirt</option>
          </select>
        </div>
        <div class="form-group">
          <label for="text-query">üîç Arama Sorgusu</label>
          <input type="text" id="text-query" placeholder="√ñrn: beyaz spor ayakkabƒ±, oversized hoodie, vintage ti≈ü√∂rt..." required>
        </div>
        <button type="submit" class="search-button">
          üöÄ Hibrit AI Arama Ba≈ülat
        </button>
      </form>

      <form class="search-form" id="image-form">
        <div class="form-group">
          <label for="image-category">üè∑Ô∏è Kategori Se√ßin</label>
          <select id="image-category" required>
            <option value="">Kategori se√ßiniz...</option>
            <option value="ayakkabi">üëü Ayakkabƒ±</option>
            <option value="sapka">üß¢ ≈ûapka</option>
            <option value="sweat">üëï Sweatshirt</option>
            <option value="tshirt">üëî T-Shirt</option>
          </select>
        </div>
        <div class="form-group">
          <label>üì∏ √úr√ºn Fotoƒürafƒ± Y√ºkleyin</label>
          <div class="file-upload" onclick="document.getElementById('image-file').click()">
            <div style="font-size:60px;margin-bottom:15px;">üì∑</div>
            <div style="font-size:18px;font-weight:600;margin-bottom:8px;">Tƒ±klayƒ±n veya S√ºr√ºkleyip Bƒ±rakƒ±n</div>
            <div style="color:#666;">JPG, PNG, JPEG formatlarƒ± desteklenir (Max 10MB)</div>
            <input type="file" id="image-file" accept="image/*" required style="display:none">
          </div>
          <div id="selected-file" style="margin-top:15px; font-weight:600; color:#28a745;"></div>
        </div>
        <button type="submit" class="search-button">
          üéØ G√∂rsel AI Arama Ba≈ülat
        </button>
      </form>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <h3>ü§ñ Hibrit AI Sistemi √áalƒ±≈üƒ±yor</h3>
      <p>RRF algoritmasƒ± ile √ßoklu vekt√∂r aramasƒ± ger√ßekle≈ütiriliyor...</p>
    </div>
    
    <div class="error" id="error"></div>

    <div class="results" id="results">
      <div id="best-offer-container"></div>
      <div id="other-offers-container" class="other-offers-container"></div>
    </div>
  </div>

  <!-- Phone Modal -->
  <div class="modal-overlay" id="phone-modal">
    <div class="modal-content">
      <h3>üì± WhatsApp Bildirim Kurulumu</h3>
      <p style="color:#666; margin-bottom:20px;">Stok veya fiyat deƒüi≈üikliƒüi bildirimi almak i√ßin telefon numaranƒ±zƒ± girin:</p>
      <input type="text" class="phone-input" id="phone-input" placeholder="5321234567" maxlength="10">
      <div style="font-size:14px; color:#888; margin-bottom:20px;">
        * Numara ba≈üƒ±nda 0 olmadan giriniz
      </div>
      <div class="modal-buttons">
        <button class="modal-button secondary" onclick="closePhoneModal()">‚ùå ƒ∞ptal</button>
        <button class="modal-button primary" onclick="confirmTrack()">‚úÖ Takibe Al</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://127.0.0.1:8000';
    let CURRENT_CATEGORY = null;
    let PENDING_TRACK_DATA = null;

    function switchTab(tab, element) {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      element.classList.add('active');
      document.querySelectorAll('.search-form').forEach(f => f.classList.remove('active'));
      document.getElementById(tab === 'text' ? 'text-form' : 'image-form').classList.add('active');
    }

    // Form submissions
    document.getElementById('text-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const category = document.getElementById('text-category').value;
      const query = document.getElementById('text-query').value;
      CURRENT_CATEGORY = category;
      await performSearch('text', { query, category });
    });

    document.getElementById('image-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      const category = document.getElementById('image-category').value;
      formData.append('category', category);
      formData.append('image', document.getElementById('image-file').files[0]);
      CURRENT_CATEGORY = category;
      await performSearch('image', formData);
    });

    async function performSearch(type, data) {
      showLoading(); hideError(); hideResults();
      try {
        const url = `${API_BASE}/api/search/${type}`;
        const options = { method: 'POST', body: type === 'text' ? JSON.stringify(data) : data };
        if (type === 'text') options.headers = { 'Content-Type': 'application/json' };

        const response = await fetch(url, options);
        const result = await response.json();

        if (!response.ok) throw new Error(result.detail || 'API hatasƒ±');
        if (result.success) displayResults(result);
        else showError('üö´ Arama ba≈üarƒ±sƒ±z oldu. L√ºtfen tekrar deneyin.');
      } catch (error) {
        console.error('Arama Hatasƒ±:', error); 
        showError(`üö´ Baƒülantƒ± hatasƒ±: ${error.message}`);
      } finally { hideLoading(); }
    }

    function displayResults(data) {
      const bestOfferContainer = document.getElementById('best-offer-container');
      const otherOffersContainer = document.getElementById('other-offers-container');
      bestOfferContainer.innerHTML = '';
      otherOffersContainer.innerHTML = '';

      const { best_offer, other_offers } = data;
      if (!best_offer || Object.keys(best_offer).length === 0) {
        showError("üîç Aramanƒ±zla e≈üle≈üen bir √ºr√ºn bulunamadƒ±. Farklƒ± anahtar kelimeler deneyiniz."); 
        return;
      }

      const stockListHTML = (best_offer.stock_details || []).map(stock => `
        <li class="stock-item">
          <span class="stock-size">Beden: ${stock.size}</span>
          ${stock.isAvailable
            ? `<span class="stock-status available">‚úÖ Stokta Var</span>`
            : `<span class="stock-status unavailable">‚ùå Stokta Yok
                 <button class="track-size-button"
                   onclick="openTrackModal('${best_offer.product_id}','stock','${stock.size}','${best_offer.shop}','${CURRENT_CATEGORY}')">
                   üîî Takip Et
                 </button>
               </span>`}
        </li>
      `).join('');

      bestOfferContainer.innerHTML = `
        <div class="best-offer-card">
          <img src="${API_BASE}${best_offer.image_url}"
               onerror="this.onerror=null;this.src='https://via.placeholder.com/280x280/667eea/ffffff?text=√úr√ºn+G√∂rseli';"
               alt="${best_offer.name}" class="best-offer-image">
          <div class="best-offer-details">
            <div class="best-offer-title">${best_offer.name}</div>
            <div class="best-offer-meta">
              <span class="meta-item">üè™ ${best_offer.shop}</span>
              <span class="meta-item">üí∞ ${best_offer.price}‚Ç∫</span>
              <span class="meta-item">‚≠ê ${best_offer.rating}</span>
              <span class="meta-item">üîç PriceLens‚Ñ¢ ${best_offer.pricelens_score}</span>
            </div>
            <ul class="stock-list">${stockListHTML}</ul>
            <button class="track-price-button"
              onclick="openTrackModal('${best_offer.product_id}','price','${best_offer.price}','${best_offer.shop}','${CURRENT_CATEGORY}')">
              üí∞ Fiyat D√º≈ü√ºnce WhatsApp ile Haber Ver
            </button>
          </div>
        </div>`;

      if (other_offers && other_offers.length > 0) {
        const otherOffersHTML = other_offers.map((offer, index) => `
          <div class="other-offer-card">
            <h4>${offer.name}</h4>
            <div class="other-offer-meta">
              <span>üè™ ${offer.shop}</span>
              <span class="other-price">${offer.price}‚Ç∫</span>
            </div>
            <div class="other-offer-meta" style="margin-top:12px;font-size:14px;color:#666;">
              <span>‚≠ê Rating: ${offer.rating}</span>
              <span>üîç PriceLens‚Ñ¢: ${offer.pricelens_score}</span>
            </div>
          </div>
        `).join('');
        otherOffersContainer.innerHTML = `
          <h3>üè¨ Diƒüer Maƒüazalardaki Se√ßenekler</h3>
          <div class="other-offers-grid">${otherOffersHTML}</div>
        `;
      }

      showResults();
    }

    // Phone Modal Functions
    function openTrackModal(productId, trackType, value, shop, category) {
      PENDING_TRACK_DATA = { productId, trackType, value, shop, category };
      document.getElementById('phone-modal').classList.add('active');
      document.getElementById('phone-input').focus();
    }

    function closePhoneModal() {
      document.getElementById('phone-modal').classList.remove('active');
      document.getElementById('phone-input').value = '';
      PENDING_TRACK_DATA = null;
    }

    async function confirmTrack() {
      const phoneNumber = document.getElementById('phone-input').value.trim();
      
      if (!phoneNumber || !/^\d{10}$/.test(phoneNumber)) {
        alert("‚ö†Ô∏è L√ºtfen 10 haneli ge√ßerli bir numara girin (ba≈üƒ±nda 0 olmadan).\n√ñrnek: 5321234567");
        return;
      }

      if (!PENDING_TRACK_DATA) return;

      const confirmButton = document.querySelector('.modal-button.primary');
      const originalText = confirmButton.textContent;
      confirmButton.textContent = '‚è≥ ƒ∞≈üleniyor...';
      confirmButton.disabled = true;

      try {
        const resp = await fetch(`${API_BASE}/api/track`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            product_id: PENDING_TRACK_DATA.productId,
            user_identifier: phoneNumber,
            track_type: PENDING_TRACK_DATA.trackType,
            value: PENDING_TRACK_DATA.value,
            shop: PENDING_TRACK_DATA.shop,
            category: PENDING_TRACK_DATA.category
          })
        });
        
        const result = await resp.json();
        
        if (!resp.ok) throw new Error(result.detail || JSON.stringify(result));
        
        // Success feedback
        confirmButton.textContent = '‚úÖ Ba≈üarƒ±lƒ±!';
        confirmButton.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
        
        setTimeout(() => {
          closePhoneModal();
          
          // Update button in results
          const trackButtons = document.querySelectorAll(`[onclick*="${PENDING_TRACK_DATA.productId}"]`);
          trackButtons.forEach(btn => {
            btn.textContent = '‚úÖ Takipte';
            btn.disabled = true;
            btn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
          });
          
          // Show success message
          showSuccessMessage(PENDING_TRACK_DATA.trackType === 'stock' ? 
            'üîî Stok takibi aktif! √úr√ºn stoƒüa girdiƒüinde WhatsApp ile bilgilendirileceksiniz.' :
            'üí∞ Fiyat takibi aktif! Fiyat d√º≈üt√ºƒü√ºnde WhatsApp ile bilgilendirileceksiniz.'
          );
        }, 1500);
        
      } catch (error) {
        console.error('Takip Hatasƒ±:', error);
        confirmButton.textContent = '‚ùå Hata Olu≈ütu';
        confirmButton.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
        alert(`‚ö†Ô∏è Bir hata olu≈ütu: ${error.message || error}`);
      } finally {
        setTimeout(() => {
          confirmButton.textContent = originalText;
          confirmButton.disabled = false;
          confirmButton.style.background = 'linear-gradient(135deg,#667eea,#764ba2)';
        }, 2000);
      }
    }

    function showSuccessMessage(message) {
      const successDiv = document.createElement('div');
      successDiv.innerHTML = `
        <div style="
          position:fixed;
          top:20px;
          right:20px;
          background:linear-gradient(135deg, #28a745, #20c997);
          color:white;
          padding:20px 25px;
          border-radius:15px;
          box-shadow:0 10px 30px rgba(40,167,69,0.4);
          z-index:2000;
          max-width:400px;
          animation:slideIn 0.5s ease;
        ">
          <div style="font-weight:600;margin-bottom:5px;">‚úÖ Takip Aktif!</div>
          <div style="font-size:14px;opacity:0.9;">${message}</div>
        </div>
      `;
      
      document.body.appendChild(successDiv);
      
      setTimeout(() => {
        successDiv.style.animation = 'slideOut 0.5s ease forwards';
        setTimeout(() => successDiv.remove(), 500);
      }, 4000);
    }

    // Utility functions
    function showLoading(){ document.getElementById('loading').classList.add('active') }
    function hideLoading(){ document.getElementById('loading').classList.remove('active') }
    function showError(m){ const el=document.getElementById('error'); el.textContent=m; el.classList.add('active') }
    function hideError(){ document.getElementById('error').classList.remove('active') }
    function showResults(){ document.getElementById('results').classList.add('active') }
    function hideResults(){ document.getElementById('results').classList.remove('active') }

    // File upload handlers
    const fileUpload = document.querySelector('.file-upload');
    const fileInput = document.getElementById('image-file');
    const selectedFileDiv = document.getElementById('selected-file');

    fileUpload?.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUpload.classList.add('dragover');
    });

    fileUpload?.addEventListener('dragleave', () => {
      fileUpload.classList.remove('dragover');
    });

    fileUpload?.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUpload.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        updateSelectedFile();
      }
    });

    fileInput?.addEventListener('change', updateSelectedFile);

    function updateSelectedFile() {
      const file = fileInput.files[0];
      if (file) {
        const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
        selectedFileDiv.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px;background:rgba(40,167,69,0.1);padding:12px;border-radius:10px;">
            <span style="font-size:24px;">üìé</span>
            <div>
              <div style="font-weight:600;">‚úÖ ${file.name}</div>
              <div style="font-size:12px;color:#666;">Dosya boyutu: ${sizeInMB} MB</div>
            </div>
          </div>
        `;
      }
    }

    // Modal close on outside click
    document.getElementById('phone-modal').addEventListener('click', (e) => {
      if (e.target.id === 'phone-modal') {
        closePhoneModal();
      }
    });

    // Enter key support for phone input
    document.getElementById('phone-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        confirmTrack();
      }
    });

    // Auto-format phone number (remove non-digits)
    document.getElementById('phone-input').addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.startsWith('0')) value = value.substring(1);
      if (value.length > 10) value = value.substring(0, 10);
      e.target.value = value;
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>